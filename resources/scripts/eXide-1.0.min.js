define("eXide/mode/xquery_highlight_rules",function(a,c){var e=a("ace/lib/oop"),d=a("ace/lib/lang"),b=a("ace/mode/text_highlight_rules").TextHighlightRules,f=function(){var b=d.arrayToMap("return for let where order by declare function variable xquery version option namespace import module switch default map if then else as and or typeswitch case ascending descending empty in".split(" "));this.$rules={start:[{token:"text",regex:"<\\!\\[CDATA\\[",next:"cdata"},{token:"xml_pe",regex:"<\\?.*?\\?>"},
{token:"comment",regex:"<\\!--",next:"comment"},{token:"comment",regex:"\\(:",next:"comment"},{token:"text",regex:"<\\/?",next:"tag"},{token:"constant",regex:"[+-]?\\d+(?:(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)?\\b"},{token:"variable",regex:"\\$[a-zA-Z_][a-zA-Z0-9_\\-:]*\\b"},{token:"string",regex:'".*?"'},{token:"string",regex:"'.*?'"},{token:"text",regex:"\\s+"},{token:"comment",regex:"\\%\\w[\\w+_\\-:]+\\b"},{token:"support.function",regex:"\\w[\\w+_\\-:]+(?=\\()"},{token:"keyword.operator",regex:"\\*|=|<|>|\\-|\\+|and|or|eq|ne|lt|gt"},
{token:"lparen",regex:"[[({]"},{token:"rparen",regex:"[\\])}]"},{token:function(f){return b[f]?"keyword":"identifier"},regex:"[a-zA-Z_$][a-zA-Z0-9_$]*\\b"}],tag:[{token:"text",regex:">",next:"start"},{token:"keyword",regex:"[-_a-zA-Z0-9:]+"},{token:"text",regex:"\\s+"},{token:"string",regex:'".*?"'},{token:"string",regex:"'.*?'"}],cdata:[{token:"text",regex:"\\]\\]>",next:"start"},{token:"text",regex:"\\s+"},{token:"text",regex:"(?:[^\\]]|\\](?!\\]>))+"}],comment:[{token:"comment",regex:".*?--\>",
next:"start"},{token:"comment",regex:".*:\\)",next:"start"},{token:"comment",regex:".+"}]}};e.inherits(f,b);c.XQueryHighlightRules=f});
define("eXide/mode/behaviour/xquery",function(a,c){var e=a("ace/lib/oop"),d=a("ace/mode/behaviour").Behaviour,b=a("ace/mode/behaviour/cstyle").CstyleBehaviour,f=function(f){this.inherit(b,["braces","parens","string_dquotes"]);this.parent=f;this.add("brackets","insertion",function(b,f,d,a,c){return"\n"==c&&(f=d.getCursorPosition(),"</"==a.doc.getLine(f.row).substring(f.column,f.column+2))?(b=this.$getIndent(a.doc.getLine(f.row))+a.getTabString(),a=this.$getIndent(a.doc.getLine(f.row)),{text:"\n"+b+
"\n"+a,selection:[1,b.length,1,b.length]}):!1});this.add("comments","insertion",function(b,f,d,a,c){b=d.getCursorPosition();a=a.doc.getLine(b.row);if("\n"==c&&a.match(/^[\(\s]:/))return{text:"\n : ",selection:[1,3,1,3]};if(":"==c&&"("==a.substring(b.column-1,1))return $.log("cursor: %d",b.column),{text:":  :",selection:[2,2]}});this.add("slash","insertion",function(b,d,a,c,e){"/"==e&&(b=a.getCursorPosition(),d=c.doc.getLine(b.row),0<b.column&&"<"==d.charAt(b.column-1)&&(d=d.substring(0,b.column)+
"/"+d.substring(b.column),a=c.doc.getAllLines(),a[b.row]=d,f.exec("closeTag",a.join(c.doc.getNewLineCharacter()),b.row)));return!1})};e.inherits(f,d);c.XQueryBehaviour=f});
define("eXide/mode/xquery",function(a,c){var e=a("ace/lib/oop"),d=a("ace/mode/text").Mode,b=a("ace/tokenizer").Tokenizer,f=a("eXide/mode/xquery_highlight_rules").XQueryHighlightRules,h=a("eXide/mode/behaviour/xquery").XQueryBehaviour,j=a("ace/range").Range,g=function(d){this.$tokenizer=new b((new f).getRules());this.$behaviour=new h(d)};e.inherits(g,d);(function(){this.getNextLineIndent=function(b,f,d){b=this.$getIndent(f);f.match(/\s*(?:then|else|return|[{\(]|<\w+>)\s*$/)&&(b+=d);return b};this.checkOutdent=
function(b,f,d){return!/^\s+$/.test(f)?!1:/^\s*[\}\)]/.test(d)};this.autoOutdent=function(b,f,d){b=f.getLine(d).match(/^(\s*[\}\)])/);if(!b)return 0;var b=b[1].length,a=f.findMatchingBracket({row:d,column:b});if(!a||a.row==d)return 0;a=this.$getIndent(f.getLine(a.row));f.replace(new j(d,0,d,b-1),a)};this.$getIndent=function(b){return(b=b.match(/^(\s+)/))?b[1]:""};this.toggleCommentLines=function(b,f,d,a){for(var c=!0,h=/^\s*\(:(.*):\)/,b=d;b<=a;b++)if(!h.test(f.getLine(b))){c=!1;break}for(var e=new j(0,
0,0,0),b=d;b<=a;b++)d=f.getLine(b),e.start.row=b,e.end.row=b,e.end.column=d.length,f.replace(e,c?d.match(h)[1]:"(:"+d+":)")}}).call(g.prototype);c.Mode=g});
define("eXide/mode/behaviour/xml",function(a,c){var e=a("ace/lib/oop"),d=a("ace/mode/behaviour").Behaviour,b=a("ace/mode/behaviour/cstyle").CstyleBehaviour;a("eXide/mode/behaviour/xquery");var f=function(f){this.inherit(b,["braces","parens","string_dquotes"]);this.parent=f;this.add("brackets","insertion",function(b,f,d,a,c){return"\n"==c&&(f=d.getCursorPosition(),"</"==a.doc.getLine(f.row).substring(f.column,f.column+2))?(b=this.$getIndent(a.doc.getLine(f.row))+a.getTabString(),a=this.$getIndent(a.doc.getLine(f.row)),
{text:"\n"+b+"\n"+a,selection:[1,b.length,1,b.length]}):!1});this.add("slash","insertion",function(b,d,a,c,e){"/"==e&&(b=a.getCursorPosition(),d=c.doc.getLine(b.row),0<b.column&&"<"==d.charAt(b.column-1)&&(d=d.substring(0,b.column)+"/"+d.substring(b.column),a=c.doc.getAllLines(),a[b.row]=d,f.exec("closeTag",a.join(c.doc.getNewLineCharacter()),b.row)));return!1})};e.inherits(f,d);c.XMLBehaviour=f});
define("eXide/mode/xml",function(a,c){var e=a("ace/lib/oop"),d=a("ace/mode/xml").Mode,b=a("ace/tokenizer").Tokenizer,f=a("ace/mode/xml_highlight_rules").XmlHighlightRules,h=a("ace/mode/folding/xml").FoldMode,j=a("eXide/mode/behaviour/xml").XMLBehaviour,g=a("ace/range").Range,i=function(d){this.$tokenizer=new b((new f).getRules());this.$behaviour=new j(d);this.foldingRules=new h};e.inherits(i,d);(function(){this.toggleCommentLines=function(b,f,d,a){for(var c=!0,h=/^\s*<\!--(.*)--\>/,b=d;b<=a;b++)if(!h.test(f.getLine(b))){c=
!1;break}for(var e=new g(0,0,0,0),b=d;b<=a;b++)d=f.getLine(b),e.start.row=b,e.end.row=b,e.end.column=d.length,f.replace(e,c?d.match(h)[1]:"<\!--"+d+"--\>")}}).call(i.prototype);c.Mode=i});
define("eXide/mode/html",function(a,c){var e=a("ace/lib/oop"),d=a("ace/mode/html").Mode,b=a("ace/tokenizer").Tokenizer,f=a("ace/mode/html_highlight_rules").HtmlHighlightRules,h=a("ace/mode/folding/html").FoldMode,j=a("eXide/mode/behaviour/xml").XMLBehaviour,g=a("ace/range").Range,i=a("ace/mode/javascript").Mode,l=a("ace/mode/css").Mode,m=function(d){var a=new f;this.$tokenizer=new b(a.getRules());this.$behaviour=new j(d);this.foldingRules=new h;this.$embeds=a.getEmbeds();this.createModeDelegates({"js-":i,
"css-":l})};e.inherits(m,d);(function(){this.toggleCommentLines=function(b,f,d,a){for(var c=!0,h=/^\s*<\!--(.*)--\>/,b=d;b<=a;b++)if(!h.test(f.getLine(b))){c=!1;break}for(var e=new g(0,0,0,0),b=d;b<=a;b++)d=f.getLine(b),e.start.row=b,e.end.row=b,e.end.column=d.length,f.replace(e,c?d.match(h)[1]:"<\!--"+d+"--\>")}}).call(m.prototype);c.Mode=m});var eXide=eXide||{};eXide.namespace=function(a){var a=a.split("."),c=eXide,e;"eXide"==a[0]&&(a=a.slice(1));for(e=0;e<a.length;e++)"undefined"==typeof c[a[e]]&&(c[a[e]]={}),c=c[a[e]];return c};eXide.namespace("eXide.util");
eXide.util=function(){var a={dir1:"up",dir2:"left",firstpos1:15,firstpos2:15};return{popup:function(a,e,d,b){function f(b){j&&(j.empty(),b.find(".tooltip").each(function(){j.html($(this).html())}))}var h=$(a),j=e?$(e):null,g=null;d.sort(function(b,f){return b.label==f.label?0:b.label>f.label?1:-1});h.empty().css("display","block").focus();a=document.createElement("a");a.href="#";a.className="popup-close";a.appendChild(document.createTextNode("Close"));h.append(a);$(a).click(function(b){b.preventDefault();
h.css("display","none");j&&j.css("display","none")});a=document.createElement("ul");for(e=0;e<d.length;e++){var i=document.createElement("li");0==e&&(i.className="first");i.appendChild(document.createTextNode(d[e].label));if(d[e].tooltip){var l=document.createElement("span");l.className="tooltip";l.appendChild(document.createTextNode(d[e].tooltip));i.appendChild(l)}a.appendChild(i);$(i).click(function(){g.removeClass("selection");$(this).addClass("selection");g=$(this);f(g)});$(i).dblclick(function(){var f=
h.find("li").index(g);h.css("display","none");j&&j.css("display","none");b.call(null,d[f])})}h.append(a);g=h.find("ul li:first").addClass("selection");f(g);var m=$(a).css("position","absolute").scrollTop(0);j&&j.css({display:"block",top:m.offset().top+"px"});var n=m.innerHeight();$(h).keydown(function(a){a.preventDefault();if(40==a.which)a=g.next(),0<a.length&&(g.removeClass("selection"),a.addClass("selection"),g=a,a.position().top+a.height()>=n&&a.get(0).scrollIntoView(),f(a));else if(38==a.which)a=
g.prev(),0<a.length&&(g.removeClass("selection"),a.addClass("selection"),g=a,a.hasClass("first")?m.scrollTop(0):0>a.position().top&&a.get(0).scrollIntoView(),f(a));else if(13==a.which){var c=h.find("li").index(g);h.css("display","none");j&&j.css("display","none");$(h).unbind(a);b.call(null,d[c])}else return h.css("display","none"),j&&j.css("display","none"),$(h).unbind(a),b.call(null,null),!0;return!1})},supportsHtml5Storage:function(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return!1}},
normalizePath:function(a){if(!a)return a;for(var a=a.replace(/^xmldb:exist:\/\//,""),e=[],a=a.split("/"),d=a.length-1;-1<d;d--)".."==a[d]?d--:e.push(a[d]);return e.reverse().join("/")},parseSignature:function(a){var e=a.indexOf("(");if(-1<e){var d=a.substring(0,e+1),a=a.substring(e);if(a=a.match(/\$[\w:-_]+/g))for(e=0;e<a.length;e++)0<e&&(d+=", "),d+=a[e];return d+")"}return a},message:function(c){$.pnotify({pnotify_text:c,pnotify_shadow:!0,pnotify_hide:!0,pnotify_closer:!0,pnotify_opacity:0.75,pnotify_addclass:"stack-bottomright",
pnotify_stack:a})},error:function(c,e){var d={pnotify_text:c,pnotify_type:"error",pnotify_shadow:!0,pnotify_hide:!0,pnotify_addclass:"stack-bottomright",pnotify_stack:a};e&&(d.pnotify_title=e);$.pnotify(d)}}}();eXide.namespace("eXide.util.Dialog");
eXide.util.Dialog=function(){var a,c=null;$(document).ready(function(){$(document.body).append('<div id="eXide-dialog-message">\t<img id="eXide-dialog-message-icon" src="resources/images/error.png"/>\t<div id="eXide-dialog-message-body"></div></div>');a=$("#eXide-dialog-message");a.dialog({modal:!0,autoOpen:!1,buttons:{OK:function(){$(this).dialog("close")}}});$(document.body).append('<div id="eXide-dialog-input">\t<img id="eXide-dialog-input-icon" src="resources/images/information.png"/>\t<div id="eXide-dialog-input-body"></div></div>');
inputDialog=$("#eXide-dialog-input");inputDialog.dialog({modal:!0,autoOpen:!1,buttons:{OK:function(){$(this).dialog("close");null!=c&&c.apply($("eXide-dialog-input-body"),[])},Cancel:function(){$(this).dialog("close")}}})});return{message:function(c,d){null==d&&(d="");a.dialog("option","title",c);$("#eXide-dialog-message-body").html(d);$("#eXide-dialog-message-icon").attr("src","resources/images/information.png");a.dialog("open")},warning:function(c,d){null==d&&(d="");a.dialog("option","title",c);
$("#eXide-dialog-message-body").html(d);$("#eXide-dialog-message-icon").attr("src","resources/images/error.png");a.dialog("open")},input:function(a,d,b){c=b;inputDialog.dialog("option","title",a);$("#eXide-dialog-input-body").html(d);inputDialog.dialog("open")}}}();eXide.namespace("eXide.util.mimeTypes");
eXide.util.mimeTypes=function(){var a={xml:["text/xml","application/xml","application/xhtml+xml","application/atom+xml"],xquery:["application/xquery"],css:["text/css"],html:["text/html"],javascript:["application/x-javascript"],text:["text/text"],less:["application/less"]};return{getMime:function(a){var e=a.indexOf(";");-1<e&&(a=a.substring(0,e));return a},getLangFromMime:function(c){for(var e in a)for(var d=a[e],b=0;b<d.length;b++)if(c==d[b])return e;return"xquery"},getMimeFromLang:function(c){return(c=
a[c])?c[0]:"application/xquery"}}}();eXide.namespace("eXide.util.oop");eXide.util.oop.inherit=function(){var a=function(){};return function(c,e){a.prototype=e.prototype;c.prototype=new a;c.super_=e.prototype;c.prototype.constructor=c}}();eXide.util.oop.extend=function(){return function(a,c){for(var e in c)c.hasOwnProperty(e)&&(a[e]=c[e])}}();(function(a){a.log=function(){window.console&&window.console.log&&console.log.apply(window.console,arguments)};a.fn.log=function(){a.log(this);return this}})(jQuery);eXide.namespace("eXide.events.Sender");eXide.events.Sender=function(){Constr=function(){};Constr.prototype={addEventListener:function(a,c,e){this.events=this.events||{};var d=this.events[a];d||(d=[],this.events[a]=d);d.push({obj:c,callback:e})},$triggerEvent:function(a,c){this.events=this.events||{};var e=this.events[a];if(e)for(var d=0;d<e.length;d++)e[d].callback.apply(e[d].obj,c)}};return Constr}();eXide.namespace("eXide.edit.commands");
eXide.edit.commands=function(){function a(a){return{win:a[0],mac:a[1],sender:"editor"}}var c=require("ace/lib/useragent"),e={};return{init:function(d){commands=d.editor.commands;$.ajax({url:"keybindings.js",dataType:"json",async:!1,success:function(b){commands.addCommand({name:"fold",bindKey:a(b.fold),exec:function(b){b.editor.session.toggleFold(!1)},readOnly:!0});commands.addCommand({name:"unfold",bindKey:a(b.unfold),exec:function(b){b.editor.session.toggleFold(!0)},readOnly:!0});commands.addCommand({name:"saveDocument",
bindKey:a(b.saveDocument),exec:function(){eXide.app.saveDocument()}});commands.addCommand({name:"runQuery",bindKey:a(b.runQuery),exec:function(){eXide.app.runQuery()}});commands.addCommand({name:"openDocument",bindKey:a(b.openDocument),exec:function(){eXide.app.openDocument()}});commands.addCommand({name:"newDocument",bindKey:a(b.newDocument),exec:function(){eXide.app.newDocument()}});commands.addCommand({name:"closeDocument",bindKey:a(b.closeDocument),exec:function(){eXide.app.closeDocument()}});
commands.addCommand({name:"autocomplete",bindKey:a(b.autocomplete),exec:function(){d.autocomplete()}});commands.addCommand({name:"nextTab",bindKey:a(b.nextTab),exec:function(){d.nextTab()}});commands.addCommand({name:"previousTab",bindKey:a(b.previousTab),exec:function(){d.previousTab()}});commands.addCommand({name:"functionDoc",bindKey:a(b.functionDoc),exec:function(){d.exec("showFunctionDoc")}});commands.addCommand({name:"gotoDefinition",bindKey:a(b.gotoDefinition),exec:function(){d.exec("gotoDefinition")}});
commands.addCommand({name:"searchIncremental",bindKey:a(b.searchIncremental),exec:function(){d.quicksearch.start()}});commands.addCommand({name:"findModule",bindKey:a(b.findModule),exec:function(){var b=d.getActiveDocument();eXide.find.Modules.select(b.syntax)}});commands.addCommand({name:"indentOrParam",bindKey:a(b.indentOrParam),exec:function(){var b=d.getActiveDocument();(!b.template||!b.template.nextParam())&&d.editor.indent()}});commands.addCommand({name:"escape",bindKey:a(b.escape),exec:function(){d.getActiveDocument().template=
null;d.editor.clearSelection()}});commands.addCommand({name:"dbManager",bindKey:a(b.dbManager),exec:function(){eXide.app.manage()}});commands.addCommand({name:"toggleComment",bindKey:a(b.toggleComment),exec:function(){d.editor.toggleCommentLines()}});commands.addCommand({name:"synchronize",bindKey:a(b.synchronize),exec:function(){eXide.app.synchronize()}});commands.addCommand({name:"preferences",bindKey:a(b.preferences),exec:function(){eXide.app.showPreferences()}});commands.addCommand({name:"openApp",
bindKey:a(b.openApp),exec:function(){eXide.app.openApp()}});b=d.editor.commands;for(key in b.commands){var f=b.commands[key],h;f.bindKey&&(h=c.isMac?f.bindKey.mac:f.bindKey.win);e[f.name]=h}}})},help:function(a,b){$(a).find("table").each(function(){this.innerHTML="";var a=b.editor.commands;for(key in a.commands){var d=a.commands[key],e=document.createElement("tr"),g=document.createElement("td");g.appendChild(document.createTextNode(d.name));e.appendChild(g);g=document.createElement("td");d.bindKey&&
(c.isMac?g.appendChild(document.createTextNode(d.bindKey.mac)):g.appendChild(document.createTextNode(d.bindKey.win)));e.appendChild(g);this.appendChild(e)}})},getShortcut:function(a){return e[a]}}}();eXide.namespace("eXide.edit.ModeHelper");
eXide.edit.ModeHelper=function(){Constr=function(a){this.parent=a;this.editor=this.parent.editor;this.commands={};this.addCommand("locate",this.locate)};Constr.prototype={addCommand:function(a,c){this.commands||(this.commands={});this.commands[a]=c},exec:function(a,c,e){if(this.commands&&this.commands[a]){for(var c=[c],d=0;d<e.length;d++)c.push(e[d]);$.log("Calling command %s ...",a);this.commands[a].apply(this,c)}else eXide.util.message("Not supported in this mode.")},createOutline:function(){},
documentSaved:function(){},locate:function(a,c,e){"number"==typeof e&&(this.editor.gotoLine(e+1),this.editor.focus());return!1}};return Constr}();eXide.namespace("eXide.edit.XQueryModeHelper");
eXide.edit.XQueryModeHelper=function(){function a(a){var b;b=a.line?a["#text"]:a;var f=e.exec(b),c=-1;f?c=parseInt(f[1])-1:a.line&&(c=parseInt(a.line)-1);return{line:c,msg:b}}var c=/^[\$\w:\-_\.]+/;Constr=function(a){this.parent=a;this.editor=this.parent.editor;this.funcDefRe=/declare\s+((?:%[\w\:\-]+(?:\([^\)]*\))?\s*)*)function\s+([^\(]+)\(/g;this.varDefRe=/declare\s+(?:%\w+\s+)*variable\s+\$[^\s;]+/gm;this.varRe=/declare\s+(?:%\w+\s+)*variable\s+(\$[^\s;]+)/;this.parseImportRe=/import\s+module\s+namespace\s+[^=]+\s*=\s*["'][^"']+["']\s*at\s+["'][^"']+["']\s*;/g;
this.moduleRe=/import\s+module\s+namespace\s+([^=\s]+)\s*=\s*["']([^"']+)["']\s*at\s+["']([^"']+)["']\s*;/;this.addCommand("showFunctionDoc",this.showFunctionDoc);this.addCommand("gotoDefinition",this.gotoDefinition);this.addCommand("locate",this.locate);this.addCommand("closeTag",this.closeTag);this.addCommand("importModule",this.importModule)};eXide.util.oop.inherit(Constr,eXide.edit.ModeHelper);Constr.prototype.closeTag=function(d,b,f){var d="xmldb:exist://"+d.getBasePath(),c=this;$.ajax({type:"POST",
url:"modules/compile.xql",data:{q:b,base:d},dataType:"json",success:function(b){"fail"==b.result&&(b=a(b.error),b.line<=f&&(b=/constructor:\s(.*)$/.exec(b.msg),0<b.length&&c.editor.insert(b[1]+">")))},error:function(){}})};Constr.prototype.validate=function(a,b,f){$.log("Running validation...");var c=this,e="xmldb:exist://"+a.getBasePath();$.ajax({type:"POST",url:"modules/compile.xql",data:{q:b,base:e},dataType:"json",success:function(b){c.compileError(b,a);f.call(this,!0)},error:function(b,a){f.call(this,
!0);$.log("Compile error: %s - %s",a,b.responseText)}})};Constr.prototype.compileError=function(d,b){if("fail"==d.result){var f=a(d.error),c=[{row:f.line,text:f.msg,type:"error"}];this.parent.updateStatus(f.msg,b.getPath()+"#"+f.line);b.getSession().setAnnotations(c)}else this.parent.clearErrors(),this.parent.updateStatus("")};Constr.prototype.autocomplete=function(a){require("pilot/lang");for(var b=require("ace/range").Range,f=this.editor.getSelection(),c=a.getSession(),f=f.getSelectionLead(),c=
c.getDisplayLine(f.row),e=f.column-1,g=f.column;0<=e;){var i=c.substring(e,g);if(i.match(/^\$[\w:\-_\.]+$/))break;if(!i.match(/^[\w:\-_\.]+$/)){e++;break}e--}c=c.substring(e,g);$.log("completing token: %s",c);b=new b(f.row,e,f.row,g);f=this.editor.renderer.textToScreenCoordinates(f.row,f.column);e=this.parent.getHeight();f.pageY+150>e&&(f.pageY=e-150,$.log("window height: %i, pageY: %i",e,f.pageY));$("#autocomplete-box").css({left:f.pageX+"px",top:f.pageY+10+"px"});$("#autocomplete-help").css({left:f.pageX+
324+"px",top:f.pageY+10+"px"});0==c.length?this.templateLookup(a,c,b,!0):this.functionLookup(a,c,b,!0);return!0};Constr.prototype.$localVars=function(a,b){for(var f=[],c=/declare function|};/,e=/let \$[\w\:]+|for \$[\w\:]+|\$[\w\:]+\)/,g=/\$[\w\:]+/,i=RegExp("^\\"+a),l=this.editor.getSession(),m=b.start.row;-1<m;){var n=l.getDisplayLine(m),o;if(o=n.match(e))$.log("Var: %s",o[0]),o=o[0].match(g),o[0].match(i)&&f.push({name:o[0],type:"variable"});if(n.match(c)){$.log("Stop: %s",n);break}m--}return f};
Constr.prototype.functionLookup=function(a,b,f,c){var e=this;$.ajax({url:"modules/docs.xql",dataType:"text",type:"POST",data:{prefix:b},success:function(g){var g=$.parseJSON(g),i=[],l;"$"==b.substring(0,1)?(l="^\\"+b,i=e.$localVars(b,f,c)):l="^"+b;var m=RegExp(l);$.each(a.functions,function(b,a){a.name.match(m)&&i.push(a)});g&&(i=i.concat(g));g=[];for(l=0;l<i.length;l++){var n={label:i[l].signature?i[l].signature:i[l].name,type:i[l].type};i[l].help&&(n.tooltip=i[l].help);g.push(n)}e.$addTemplates(b,
g);e.$showPopup(a,f,g)},error:function(b,a){eXide.util.error(a)}})};Constr.prototype.templateLookup=function(a,b,f){var c=[];this.$addTemplates(b,c);this.$showPopup(a,f,c)};Constr.prototype.$addTemplates=function(a,b){for(var f=this.parent.outline.getTemplates(a),c=0;c<f.length;c++)b.push({type:"template",label:"[S] "+f[c].name,tooltip:f[c].help,template:f[c].template})};Constr.prototype.$showPopup=function(a,b,f){var c=this;eXide.util.popup($("#autocomplete-box"),$("#autocomplete-help"),f,function(f){if(f){var e=
f.label;"template"==f.type?e=f.template:"function"==f.type&&(e=eXide.util.parseSignature(e));a.template=new eXide.edit.Template(c.parent,b,e,f.type);a.template.insert()}c.editor.focus()})};Constr.prototype.getFunctionAtCursor=function(a){var b=a.row,b=this.editor.getSession().getDisplayLine(b),f=a.column;do f--;while(0<=f&&b.charAt(f).match(c));f++;for(a=a.column;a<b.length&&b.charAt(a).match(c);)a++;return b.substring(f,a)};Constr.prototype.showFunctionDoc=function(a){var b=this.editor.getSelection().getSelectionLead(),
f=this.editor.renderer.textToScreenCoordinates(b.row,b.column);$("#autocomplete-box").css({left:f.pageX+"px",top:f.pageY+20+"px"});$("#autocomplete-help").css({left:f.pageX+324+"px",top:f.pageY+20+"px"});b=this.getFunctionAtCursor(b);this.functionLookup(a,b,null,!1)};Constr.prototype.gotoDefinition=function(a){var b=this.editor.getSelection().getSelectionLead();(b=this.getFunctionAtCursor(b))&&this.parent.outline.gotoDefinition(a,b)};Constr.prototype.locate=function(a,b,f){switch(b){case "function":this.gotoFunction(a,
f);break;default:this.gotoVarDecl(a,f)}};Constr.prototype.gotoFunction=function(a,b){$.log("Goto function %s",b);var f=this.getModuleNamespacePrefix();null!=f&&(b=b.replace(/[^:]+:/,f+":"));for(var f=RegExp("function\\s+"+b+"\\s*\\("),c=a.$session.getLength(),e=0;e<c;e++)if(a.$session.getLine(e).match(f)){this.editor.gotoLine(e+1);this.editor.focus();break}};Constr.prototype.gotoVarDecl=function(a,b){var f=this.getModuleNamespacePrefix();null!=f&&(b=b.replace(/[^:]+:/,"$"+f+":"));$.log("Goto variable declaration %s",
b);for(var f=RegExp("variable\\s+\\"+b),c=a.$session.getLength(),e=0;e<c;e++)if(a.$session.getLine(e).match(f)){this.editor.gotoLine(e+1);this.editor.focus();break}};Constr.prototype.getModuleNamespacePrefix=function(){for(var a=/^\s*module\s+namespace\s+([^=\s]+)\s*=/,b=this.parent.getActiveDocument().$session.getLength(),f=0;f<b;f++){var c=this.parent.getActiveDocument().$session.getLine(f).match(a);if(c)return c[1]}return null};Constr.prototype.importModule=function(a,b,f,c){$.log("location = %s path = %s",
c,a.path);a=a.getBasePath();c=0===c.lastIndexOf(a,0)?c.substring(a.length+1):"xmldb:exist://"+c;this.editor.insert("import module namespace "+b+'="'+f+'" at "'+c+'";\n')};Constr.prototype.createOutline=function(a,b){var f=a.getText();this.$parseLocalFunctions(f,a);b&&b(a);(f=this.$parseImports(f))&&this.$resolveImports(a,f,b)};Constr.prototype.$sortFunctions=function(a){a.functions.sort(function(b,a){return b.name==a.name?0:b.name>a.name?1:-1})};Constr.prototype.$parseLocalFunctions=function(a,b){for(b.functions=
[];;){var f=this.funcDefRe.exec(a);if(null==f)break;var c=this.funcDefRe.lastIndex,e=this.$findMatchingParen(a,c),g=3==f.length?f[2]:f[1],f=3==f.length?f[1]:"public";-1!==f.indexOf("%private")&&(f="private");b.functions.push({type:eXide.edit.Document.TYPE_FUNCTION,name:g,visibility:f,signature:g+"("+a.substring(c,e)+")"})}if(c=a.match(this.varDefRe))for(e=0;e<c.length;e++)g=this.varRe.exec(c[e]),b.functions.push({type:eXide.edit.Document.TYPE_VARIABLE,name:g[1]});this.$sortFunctions(b)};Constr.prototype.$findMatchingParen=
function(a,b){for(var f=1,c=b;c<a.length;c++){var e=a.charAt(c);if(")"==e){if(f-=1,0==f)return c}else"("==e&&(f+=1)}return-1};Constr.prototype.$parseImports=function(a){return a.match(this.parseImportRe)};Constr.prototype.$resolveImports=function(a,b,f){for(var c=this,e=[],g=[],i=0;i<b.length;i++){var l=this.moduleRe.exec(b[i]);null!=l&&4==l.length&&(g.push("prefix="+encodeURIComponent(l[1])),g.push("uri="+encodeURIComponent(l[2])),g.push("source="+encodeURIComponent(l[3])))}b="xmldb:exist://"+a.getBasePath();
g.push("base="+encodeURIComponent(b));$.ajax({url:"outline",dataType:"json",type:"POST",data:g.join("&"),success:function(b){if(null!=b){for(var b=b.modules,i=0;i<b.length;i++){var g=b[i].functions;if(g)for(var l=0;l<g.length;l++)e.push({type:eXide.edit.Document.TYPE_FUNCTION,name:g[l].name,signature:g[l].signature,visibility:g[l].visibility,source:b[i].source});if(g=b[i].variables)for(l=0;l<g.length;l++)e.push({type:eXide.edit.Document.TYPE_VARIABLE,name:"$"+g[l],source:b[i].source})}a.functions=
a.functions.concat(e);c.$sortFunctions(a);f&&f(a)}}});return e};var e=/.*line:?\s(\d+)/i;return Constr}();eXide.namespace("eXide.edit.XMLModeHelper");
eXide.edit.XMLModeHelper=function(){Constr=function(a){this.parent=a;this.editor=this.parent.editor;this.addCommand("closeTag",this.closeTag)};eXide.util.oop.inherit(Constr,eXide.edit.ModeHelper);Constr.prototype.closeTag=function(a,c,e){a.getBasePath();var d=this;$.ajax({type:"POST",url:"modules/validate-xml.xql",data:{xml:c},dataType:"json",success:function(b){b.status&&"invalid"==b.status&&parseInt(b.message.line)-1<=e&&(b=/element type \"([^\"]+)\"/.exec(b.message["#text"]),0<b.length&&d.editor.insert(b[1]+
">"))},error:function(){}})};Constr.prototype.validate=function(a,c,e){var d=this;$.ajax({type:"POST",url:"modules/validate-xml.xql",data:{xml:c},dataType:"json",success:function(b){d.compileError(b,a);e.call(this,!0)},error:function(b,a){e.call(this,!0);$.log("Compile error: %s - %s",a,b.responseText)}})};Constr.prototype.compileError=function(a,c){$.log("Validation returned %o",a);if(a.status&&"invalid"==a.status){var e=[{row:parseInt(a.message.line)-1,text:a.message["#text"],type:"error"}];$.log("annotation: %o",
e);this.parent.updateStatus(a.message["#text"],c.getPath()+"#"+a.message.line);c.getSession().setAnnotations(e)}else this.parent.clearErrors(),this.parent.updateStatus("")};return Constr}();eXide.namespace("eXide.edit.LessModeHelper");
eXide.edit.LessModeHelper=function(){var a=require("ace/token_iterator").TokenIterator;Constr=function(a){this.parent=a;this.editor=this.parent.editor;this.addCommand("locate",this.locate)};eXide.util.oop.inherit(Constr,eXide.edit.ModeHelper);Constr.prototype.documentSaved=function(a){var e=this,d=a.getText(),b="/exist/apps/"+a.getBasePath().replace(/^\/db\//,"")+"/";(new less.Parser({paths:[b],optimization:3})).parse(d,function(b,d){if(b)return $.error(b);e.saveCSS(a,d.toCSS())})};Constr.prototype.saveCSS=
function(a,e){var d=a.getPath().replace(/\.less$/,".css");eXide.util.message("Compiling less file to "+d);$.ajax({url:"modules/store.xql",type:"POST",data:{path:d,data:e,mime:"text/css"},dataType:"json",success:function(b){"error"==b.status?eXide.util.error(b.message):eXide.util.message(d+" stored.")},error:function(b){eXide.util.error(b.responseText)}})};Constr.prototype.createOutline=function(c,e){for(var d=new a(c.getSession(),0,0),b=d.stepForward(),f="";null!=b;)"variable"==b.type||"keyword"==
b.type?(0<f.length&&(f+=" "),f+=b.value):"paren.lparen"==b.type&&(c.functions.push({type:eXide.edit.Document.TYPE_FUNCTION,name:f,source:c.getPath(),signature:f,row:d.getCurrentTokenRow(),column:d.getCurrentTokenColumn()}),f=""),b=d.stepForward();e&&e(c)};return Constr}();eXide.namespace("eXide.edit.JavascriptModeHelper");
eXide.edit.JavascriptModeHelper=function(){var a=require("ace/token_iterator").TokenIterator;Constr=function(a){this.parent=a;this.editor=this.parent.editor;this.addCommand("locate",this.locate)};eXide.util.oop.inherit(Constr,eXide.edit.ModeHelper);Constr.prototype.createOutline=function(c,e){for(var d=new a(c.getSession(),0,0),b=d.stepForward();null!=b;)"entity.name.function"==b.type&&c.functions.push({type:eXide.edit.Document.TYPE_FUNCTION,name:b.value,signature:b.value,row:d.getCurrentTokenRow(),
column:d.getCurrentTokenColumn()}),b=d.stepForward();e&&e(c)};return Constr}();eXide.namespace("eXide.edit.CssModeHelper");
eXide.edit.CssModeHelper=function(){var a=require("ace/token_iterator").TokenIterator;Constr=function(a){this.parent=a;this.editor=this.parent.editor;this.addCommand("locate",this.locate)};eXide.util.oop.inherit(Constr,eXide.edit.ModeHelper);Constr.prototype.createOutline=function(c,e){for(var d=new a(c.getSession(),0,0),b=d.stepForward(),f="";null!=b;)"variable"==b.type||"keyword"==b.type?(0<f.length&&(f+=" "),f+=b.value):"paren.lparen"==b.type&&(c.functions.push({type:eXide.edit.Document.TYPE_FUNCTION,name:f,
source:c.getPath(),signature:f,row:d.getCurrentTokenRow(),column:d.getCurrentTokenColumn()}),f=""),b=d.stepForward();e&&e(c)};return Constr}();eXide.namespace("eXide.edit.Outline");
eXide.edit.Outline=function(){Constr=function(){this.currentDoc=null;this.templates=[];this.$loadTemplates()};Constr.prototype={getTemplates:function(a){for(var a=RegExp("^"+a),c=[],e=0;e<this.templates.length;e++)this.templates[e].name.match(a)&&c.push(this.templates[e]);return c},gotoDefinition:function(a,c){$.each(a.functions,function(a,d){c==d.name&&eXide.app.locate(d.type,""==d.source?null:d.source,c)})},updateOutline:function(a){var c=this;c.currentDoc=a;a.functions=[];$("#outline").empty();
var e=a.getModeHelper();null!=e&&e.createOutline(a,function(){c.$outlineUpdate(a)})},clearOutline:function(){$("#outline").empty()},$outlineUpdate:function(a){if(this.currentDoc==a){$.log("Updating outline");$("body").layout();eXide.app.resize();var c=$("#outline");c.empty();for(var e=0;e<a.functions.length;e++){var d=a.functions[e],b=document.createElement("li"),f=document.createElement("a");d.signature&&(f.title=d.signature);var h=$(f);d.type==eXide.edit.Document.TYPE_FUNCTION?h.addClass("t_function"):
h.addClass("t_variable");f.href=d.source?"#"+d.source:"#";"private"===d.visibility?h.addClass("private"):h.addClass("public");d.row&&(f.dataset.row=d.row);f.appendChild(document.createTextNode(d.name));b.appendChild(f);c.append(b);h.click(function(b){b.preventDefault();b=this.hash.substring(1);this.dataset.row?eXide.app.locate("function",b==""?null:b,parseInt(this.dataset.row)):$(this).hasClass("t_function")?eXide.app.locate("function",b==""?null:b,$(this).text()):eXide.app.locate("variable",b==""?
null:b,$(this).text())})}}},$loadTemplates:function(){var a=this;$.ajax({url:"templates/snippets.xml",dataType:"xml",type:"GET",success:function(c){$(c).find("snippet").each(function(){var c=$(this),d=c.attr("abbrev"),b=c.find("description").text(),c=c.find("code").text();a.templates.push({TYPE:eXide.edit.Document.TYPE_TEMPLATE,name:d,help:b,template:c})})}})}};return Constr}();eXide.namespace("eXide.edit.Document");
eXide.edit.Document=function(){Constr=function(a,c,e){this.name=a;this.path=c;this.mime=null;this.syntax="xquery";this.saved=!1;this.editable=!0;this.functions=[];this.helper=null;this.history=[];this.$session=e;a=eXide.app.getPreference("softWrap");this.$session.setUseWrapMode(0!=a);0<a?this.$session.setWrapLimitRange(a,a):0>a&&this.$session.setWrapLimitRange(null,null);this.$session.setFoldStyle("markbegin")};Constr.TYPE_FUNCTION="function";Constr.TYPE_VARIABLE="variable";Constr.TYPE_TEMPLATE="template";
Constr.prototype.getText=function(){return this.$session.getValue()};Constr.prototype.getName=function(){return this.name};Constr.prototype.getPath=function(){return this.path};Constr.prototype.setPath=function(a){this.path=a};Constr.prototype.getBasePath=function(){return this.path.replace(/(^.+)\/[^\/]*$/,"$1")};Constr.prototype.getMime=function(){return this.mime};Constr.prototype.getSyntax=function(){return this.syntax};Constr.prototype.setSyntax=function(a){this.syntax=a};Constr.prototype.getSession=
function(){return this.$session};Constr.prototype.isSaved=function(){return this.saved};Constr.prototype.isEditable=function(){return this.editable};Constr.prototype.isXQuery=function(){return"application/xquery"==this.mime};Constr.prototype.setModeHelper=function(a){this.helper=a};Constr.prototype.getModeHelper=function(){return this.helper};Constr.prototype.addToHistory=function(a){this.history.push(a)};Constr.prototype.getLastLine=function(){return this.history.pop(line)};Constr.prototype.getCurrentLine=
function(){return this.$session.getSelection().getSelectionLead().row};return Constr}();eXide.namespace("eXide.edit.Editor");
eXide.edit.Editor=function(){var a=require("ace/virtual_renderer").VirtualRenderer,c=require("ace/editor").Editor,e=require("ace/edit_session").EditSession,d=require("ace/undomanager").UndoManager;Constr=function(b,f,e){var d=this;d.container=b;d.menubar=f;d.projects=e;d.documents=[];d.activeDoc=null;d.tabCounter=0;d.newDocCounter=0;d.pendingCheck=!1;d.themes={};b=new a(d.container,"ace/theme/eclipse");b.setShowGutter(!0);this.editor=new c(b);this.editor.setBehavioursEnabled(!0);this.editor.setShowFoldWidgets(!0);
this.editor.setFadeFoldWidgets(!1);eXide.edit.commands.init(d);this.outline=new eXide.edit.Outline;this.addEventListener("activate",this.outline,this.outline.updateOutline);this.addEventListener("validate",this.outline,this.outline.updateOutline);this.addEventListener("close",this.outline,this.outline.clearOutline);this.status=document.getElementById("error-status");$(this.status).click(function(b){b.preventDefault();var a=this.pathname,b=this.hash.substring(1);if(a=d.getDocument(a))d.switchTo(a),
d.editor.gotoLine(parseInt(b)+1)});this.quicksearch=new eXide.find.IncrementalSearch($("#search-box"),this.editor);var g=$("#tabs-container");g.css({overflow:"hidden"});g.mousemove(function(b){var a=g.find("ul"),f=g.width(),a=a.find("li:last-child"),a=a[0].offsetLeft+a.outerWidth(),b=(b.pageX-g.offset().left)*(a-f)/f;g.scrollLeft(b)});this.lastChangeEvent=(new Date).getTime();this.validateTimeout=null;d.modes={xquery:new eXide.edit.XQueryModeHelper(d),xml:new eXide.edit.XMLModeHelper(d),html:new eXide.edit.XMLModeHelper(d),
javascript:new eXide.edit.JavascriptModeHelper(d)}};eXide.util.oop.inherit(Constr,eXide.events.Sender);Constr.prototype.init=function(){0==this.documents.length&&this.newDocument()};Constr.prototype.exec=function(){if(this.activeDoc.getModeHelper()){var b=Array.prototype.slice.call(arguments,1);this.activeDoc.getModeHelper().exec(arguments[0],this.activeDoc,b)}else eXide.util.message("Not supported in this mode.")};Constr.prototype.getActiveDocument=function(){return this.activeDoc};Constr.prototype.getText=
function(){return this.activeDoc.getText()};Constr.prototype.newDocument=function(b,a){for(var c=0,d=0;d<this.documents.length;d++)this.documents[d].path.match(/^__new__(\d+)/)&&(c=parseInt(RegExp.$1));c++;d=b&&"string"==typeof b?new e(b):a&&"xquery"===a?new e('xquery version "3.0";\n'):new e("");c=new eXide.edit.Document("new-document "+c,"__new__"+c,d);a?c.setSyntax(a):c.setSyntax("text");this.$initDocument(c)};Constr.prototype.newDocumentWithText=function(b,a,c){b=new eXide.edit.Document(c.name,
c.path,new e(b));b.editable=c.writable;b.mime=a;b.syntax=eXide.util.mimeTypes.getLangFromMime(a);b.saved=!1;c.line&&(b.addToHistory(c.line),this.editor.gotoLine(c.line));this.$initDocument(b)};Constr.prototype.openDocument=function(b,a,c){c.writable?eXide.util.message("Opening "+c.path):eXide.util.message("Opening "+c.path+" readonly!");b=new eXide.edit.Document(c.name,c.path,new e(b));b.editable=c.writable;b.mime=a;b.syntax=eXide.util.mimeTypes.getLangFromMime(a);b.saved=!0;c.line&&(b.addToHistory(c.line),
a=b.$session.getSelection(),a.clearSelection(),a.moveCursorTo(c.line,1),b.$session.setScrollTop(c.line));$.log("opening %s, mime: %s, syntax: %s, line: %i",c.name,b.mime,b.syntax,c.line);this.$initDocument(b)};Constr.prototype.$initDocument=function(b){var a=this;a.$setMode(b,!1);b.$session.setUndoManager(new d);b.$session.addEventListener("change",function(){b.saved&&(b.saved=!1,a.updateTabStatus(b.path,b));a.triggerCheck()});a.addTab(b);a.editor.setSession(b.$session);a.editor.resize();a.editor.focus()};
Constr.prototype.setMode=function(b){this.activeDoc.syntax=b;this.$setMode(this.activeDoc,!0)};Constr.prototype.$setMode=function(b,a){switch(b.getSyntax()){case "xquery":var c=require("eXide/mode/xquery").Mode;b.$session.setMode(new c(this));a&&(b.mime="application/xquery");break;case "xml":c=require("eXide/mode/xml").Mode;b.$session.setMode(new c(this));a&&(b.mime="application/xml");break;case "html":c=require("eXide/mode/html").Mode;b.$session.setMode(new c(this));a&&(b.mime="text/html");break;
case "javascript":c=require("ace/mode/javascript").Mode;b.$session.setMode(new c);a&&(b.mime="application/x-javascript");break;case "css":c=require("ace/mode/css").Mode;b.$session.setMode(new c);a&&(b.mime="text/css");break;case "text":c=require("ace/mode/text").Mode,b.$session.setMode(new c),a&&(b.mime="text/text");case "less":c=require("ace/mode/less").Mode,b.$session.setMode(new c),a&&(b.mime="application/less")}b.setModeHelper(this.modes[b.getSyntax()])};Constr.prototype.closeDocument=function(){this.$triggerEvent("close",
[this.activeDoc]);$('#tabs a[title="'+this.activeDoc.path+'"]').parent().remove();this.menubar.remove("buffers",this.activeDoc.path);for(var b=0;b<this.documents.length;b++)this.documents[b].path==this.activeDoc.path&&this.documents.splice(b,1);0==this.documents.length?this.newDocument(null,"xquery"):(this.activeDoc=this.documents[this.documents.length-1],$('#tabs a[title="'+this.activeDoc.path+'"]').addClass("active"),this.editor.setSession(this.activeDoc.$session),this.editor.resize(),this.$triggerEvent("activate",
[this.activeDoc]))};Constr.prototype.saveDocument=function(b,a,c){var d=this,e=d.activeDoc.path,i=d.activeDoc.name;b&&(d.activeDoc.path=b.path,d.activeDoc.name=b.name);eXide.util.message("Storing resource "+d.activeDoc.name+"...");b={path:d.activeDoc.path,data:d.activeDoc.getText()};d.activeDoc.mime&&(b.mime=d.activeDoc.mime);$.ajax({url:"modules/store.xql",type:"POST",data:b,dataType:"json",success:function(b){if(b.status=="error")c?c.apply(d.activeDoc,[b.message]):eXide.util.error(b.message);else{d.activeDoc.saved=
true;d.updateTabStatus(e,d.activeDoc);a?a.apply(d.activeDoc):eXide.util.message(d.activeDoc.name+" stored.");(b=d.activeDoc.getModeHelper())&&b.documentSaved(d.activeDoc)}},error:function(b){d.activeDoc.path=e;d.activeDoc.name=i;c?c.apply(d.activeDoc,b.responseText):eXide.util.error(b.responseText)}})};Constr.prototype.reload=function(b){this.activeDoc.getSession().setValue(b)};Constr.prototype.getDocument=function(b){for(var b=eXide.util.normalizePath(b),a=0;a<this.documents.length;a++)if(this.documents[a].path==
b)return this.documents[a]};Constr.prototype.onInput=function(b,a){var c=b.getModeHelper();if(c&&c.onInput)c.onInput(b,a)};Constr.prototype.autocomplete=function(){var b=this.activeDoc.getModeHelper();b&&b.autocomplete&&b.autocomplete(this.activeDoc)};Constr.prototype.getHeight=function(){return $(this.container).height()};Constr.prototype.resize=function(){this.editor.resize()};Constr.prototype.clearErrors=function(){this.editor.getSession().clearAnnotations()};Constr.prototype.forEachDocument=function(b){for(var a=
0;a<this.documents.length;a++)b(this.documents[a])};Constr.prototype.addTab=function(b){var a=this,c="t"+a.tabCounter++,d=b.name;b.saved||(d+="*");$("#tabs li a").removeClass("active");var e=document.createElement("li"),i=document.createElement("a");i.appendChild(document.createTextNode(d));i.className="tab active";i.id=c;i.title=b.path;e.appendChild(i);$("#tabs").append(e);$(i).click(function(c){c.preventDefault();a.switchTo(b)});a.menubar.add("buffers",d,i.title,function(){a.switchTo(b)});a.activeDoc=
b;a.documents.push(b);a.$triggerEvent("activate",[b]);a.scrollToTab($(i))};Constr.prototype.nextTab=function(){if(!(2>this.documents.length)){for(var b=0,a=0;a<this.documents.length;a++)if(this.documents[a]==this.activeDoc){b=a;break}b==this.documents.length-1?b=0:b++;this.switchTo(this.documents[b])}};Constr.prototype.previousTab=function(){if(!(2>this.documents.length)){for(var b=0,a=0;a<this.documents.length;a++)if(this.documents[a]==this.activeDoc){b=a;break}0==b?b=this.documents.length-1:b--;
this.switchTo(this.documents[b])}};Constr.prototype.switchTo=function(b){this.editor.setSession(b.$session);this.editor.resize();this.activeDoc=b;var a=this;$("#tabs a").each(function(){var c=$(this);this.title==b.path?(c.addClass("active"),a.scrollToTab(c)):c.removeClass("active")});this.updateStatus("");this.$triggerEvent("activate",[b])};Constr.prototype.updateTabStatus=function(b,a){var c;c=a.saved?a.name:a.name+"*";$('#tabs a[title="'+b+'"]').attr("title",a.path).text(c)};Constr.prototype.scrollToTab=
function(a){var c=a.offset().left,a=c+a.outerWidth(),d=$("#tabs-container").innerWidth(),e=$("#tabs-container").scrollLeft();a>d?$("#tabs-container").scrollLeft(a-d):c<e&&(c<d?$("#tabs-container").scrollLeft(0):$("#tabs-container").scrollLeft(c));$.log("Scrolling to %d %d",c,$("#tabs-container").scrollLeft())};Constr.prototype.setTheme=function(a){$.log("Changing theme to %s",a);var c=this;c.loadTheme(a,function(){c.editor.setTheme("ace/theme/"+a)})};Constr.prototype.loadTheme=function(a,c){if(this.themes[a])return c();
require("ace/lib/net");this.themes[a]=1;var d="resources/scripts/ace/theme-"+a.split("/").pop()+".js",e=document.getElementsByTagName("head")[0],g=document.createElement("script");g.src=d;e.appendChild(g);g.onload=c};Constr.prototype.updateStatus=function(a,c){this.status.innerHTML=a;c&&(this.status.href=c)};Constr.prototype.triggerCheck=function(){if(this.activeDoc.getModeHelper()){var a=this;if(!a.pendingCheck){var c=(new Date).getTime();a.validateTimeout&&2E3>c-a.lastChangeEvent&&clearTimeout(a.validateTimeout);
a.lastChangeEvent=c;a.validateTimeout=setTimeout(function(){a.validate.apply(a)},2E3)}}};Constr.prototype.validate=function(){var a=this,c=a.activeDoc.getModeHelper();c&&c.validate&&(a.pendingCheck=!0,$.log("Running validation..."),c.validate(a.activeDoc,a.getText(),function(){a.pendingCheck=!1}),a.$triggerEvent("validate",[a.activeDoc]))};Constr.prototype.evalError=function(a){var c=/.*line\s(\d+)/i.exec(a),d=-1;c&&(d=parseInt(c[1]));$.log("error in line %d",c[1]);this.editor.focus();this.editor.gotoLine(d);
c=[{row:d-1,text:a,type:"error"}];this.updateStatus(a);this.editor.getSession().setAnnotations(c)};Constr.prototype.focus=function(){this.editor.focus()};Constr.prototype.saveState=function(){var a=0;$.each(this.documents,function(c,d){if(d.path.match("^__new__.*")){var e=d.getText();e&&0<e.length&&(localStorage["eXide."+a+".path"]=d.path,localStorage["eXide."+a+".name"]=d.name,localStorage["eXide."+a+".mime"]=d.mime,localStorage["eXide."+a+".data"]=d.getText(),localStorage["eXide."+a+".last-line"]=
d.getCurrentLine())}else localStorage["eXide."+a+".path"]=d.path,localStorage["eXide."+a+".name"]=d.name,localStorage["eXide."+a+".mime"]=d.mime,localStorage["eXide."+a+".writable"]=d.editable?"true":"false",localStorage["eXide."+a+".last-line"]=d.getCurrentLine(),d.saved||(localStorage["eXide."+a+".data"]=d.getText());a++});localStorage["eXide.documents"]=a};return Constr}();$(document).ready(function(){var a;var c=window.location.search.substr(1).split("&");if(""==c)a={};else{for(var e={},d=0;d<c.length;++d){var b=c[d].split("=");2==b.length&&(e[b[0]]=decodeURIComponent(b[1].replace(/\+/g," ")))}a=e}eXide.app.init(function(b){var c=a.open,d=a.snip;c&&!b[c]?eXide.app.findDocument(a.open):d&&eXide.app.newDocument(d);"function"==typeof eXide_onload&&eXide_onload(eXide.app)})});eXide.namespace("eXide.app");
eXide.app=function(){var a,c,e,d,b,f=0,h=0,j=0,g=0;return{init:function(f){var h=new eXide.util.Menubar($(".menu"));d=new eXide.edit.Projects;a=new eXide.edit.Editor(document.getElementById("editor"),h);c=new eXide.edit.PackageEditor(d);e=new eXide.browse.Browser(document.getElementById("open-dialog"));c.addEventListener("change",null,function(){e.onChange();eXide.app.openDocument()});b=new eXide.util.Preferences(a);eXide.app.initGUI(h);h=eXide.app.restoreState();a.init();a.addEventListener("outlineChange",
eXide.app.onOutlineChange);$(window).resize(eXide.app.resize);$(window).unload(function(){eXide.app.saveState()});eXide.find.Modules.addEventListener("open",null,function(a){eXide.app.findDocument(a.at)});eXide.find.Modules.addEventListener("import",null,function(b){a.exec("importModule",b.prefix,b.uri,b.at)});f&&f(h)},resize:function(){$("#editor");$(".header");a.resize()},newDocument:function(b,c){a.newDocument(b,c)},findDocument:function(b){var c=a.getDocument(b);null==c?(b={name:b.match(/[^\/]+$/),
path:b},eXide.app.$doOpenDocument(b)):a.switchTo(c)},locate:function(b,c,d){if(null==c)a.exec("locate",b,d);else{$.log("Locating %s in document %s",d,c);var e=a.getDocument(c);null==e?(c={name:c.match(/[^\/]+$/),path:c},eXide.app.$doOpenDocument(c,function(){a.exec("locate",b,d)})):(a.switchTo(e),a.exec("locate",b,d))}},openDocument:function(){e.reload(["reload"],"open");$("#open-dialog").dialog("option","title","Open Document");$("#open-dialog").dialog("option","buttons",{cancel:function(){$(this).dialog("close");
a.focus()},open:eXide.app.openSelectedDocument});$("#open-dialog").dialog("open")},openSelectedDocument:function(a){var b=e.getSelection();b&&eXide.app.$doOpenDocument(b);(void 0==a||a)&&$("#open-dialog").dialog("close")},$doOpenDocument:function(b,c,d){b.path=eXide.util.normalizePath(b.path);var e=a.getDocument(b.path);if(e&&!d)return a.switchTo(e),!0;$.ajax({url:"modules/load.xql?path="+b.path,dataType:"text",success:function(e,f,h){d?a.reload(e):(f=eXide.util.mimeTypes.getMime(h.getResponseHeader("Content-Type")),
a.openDocument(e,f,b));c&&c.call(null,b);return!0},error:function(a){eXide.util.error("Failed to load document "+b.path+": "+a.status+" "+a.statusText);return!1}})},reloadDocument:function(){var b=a.getActiveDocument();b.isSaved()?eXide.app.$reloadDocument(b):eXide.util.Dialog.input("Reload Document","Do you really want to reload the document?",function(){eXide.app.$reloadDocument(b)})},$reloadDocument:function(a){a={name:a.getName(),path:a.getPath()};eXide.app.$doOpenDocument(a,null,!0)},closeDocument:function(){a.getActiveDocument().isSaved()?
a.closeDocument():$("#dialog-confirm-close").dialog({resizable:!1,height:140,modal:!0,buttons:{Close:function(){$(this).dialog("close");a.closeDocument()},Cancel:function(){$(this).dialog("close")}}})},saveDocument:function(){eXide.app.requireLogin(function(){a.getActiveDocument().getPath().match("^__new__")?(e.reload(["reload","create"],"save"),$("#open-dialog").dialog("option","title","Save Document"),$("#open-dialog").dialog("option","buttons",{Cancel:function(){$(this).dialog("close")},Save:function(){a.saveDocument(e.getSelection(),
function(){$("#open-dialog").dialog("close");c.autoSync(a.getActiveDocument().getBasePath())},function(a){eXide.util.Dialog.warning("Failed to Save Document",a)})}}),$("#open-dialog").dialog("open")):a.saveDocument(null,function(){eXide.util.message(a.getActiveDocument().getName()+" stored.");c.autoSync(a.getActiveDocument().getBasePath())},function(a){eXide.util.Dialog.warning("Failed to Save Document",a)})})},saveDocumentAs:function(){eXide.app.requireLogin(function(){e.reload(["reload","create"],
"save");$("#open-dialog").dialog("option","title","Save Document As ...");$("#open-dialog").dialog("option","buttons",{Cancel:function(){$(this).dialog("close")},Save:function(){a.saveDocument(e.getSelection(),function(){$("#open-dialog").dialog("close");c.autoSync(a.getActiveDocument().getBasePath())},function(a){eXide.util.Dialog.warning("Failed to Save Document",a)})}});$("#open-dialog").dialog("open")})},exec:function(){a.exec(arguments)},download:function(){var b=a.getActiveDocument();b.getPath().match("^__new__")||
!b.isSaved()?eXide.util.error("There are unsaved changes in the document. Please save it first."):window.location.href="modules/load.xql?download=true&path="+encodeURIComponent(b.getPath())},runQuery:function(){a.updateStatus("Running query ...");var b=a.getText(),c="xmldb:exist://"+a.getActiveDocument().getBasePath();$("#results-container .results").empty();$.ajax({type:"POST",url:"execute",dataType:"xml",data:{qu:b,base:c},success:function(b){b=b.documentElement;if("error"==b.nodeName)b=$(b).text(),
eXide.util.error(b,"Compilation Error"),a.evalError(b);else{a.updateStatus("");a.clearErrors();var c=$("body").layout();c.open("south");c.sizePane("south",300);eXide.app.resize();j=h=1;f=b.getAttribute("hits");g=h+10-1;f<g&&(g=f);eXide.util.message("Found "+f+" in "+b.getAttribute("elapsed")+"s");eXide.app.retrieveNext()}},error:function(a){eXide.util.error(a.responseText,"Server Error")}})},checkQuery:function(){a.validate()},retrieveNext:function(){$.log("retrieveNext: %d",j);if(0<j&&j<=g){var a=
"results/"+j;j++;$.ajax({url:a,dataType:"html",success:function(a){$("#results-container .results").append(a);$("#results-container .current").text("Showing results "+h+" to "+(j-1)+" of "+f);$("#results-container .pos:last a").click(function(){eXide.app.findDocument(this.pathname);return!1});eXide.app.retrieveNext()}})}},browseNext:function(){0<j&&g<f&&(h=j,g=j+10-1,f<g&&(g=f),$("#results-container .results").empty(),eXide.app.retrieveNext());return!1},browsePrevious:function(){0<j&&1<h&&(h-=10,
1>h&&(h=1),j=h,g=j+9,f<g&&(g=f),$("#results-container .results").empty(),eXide.app.retrieveNext());return!1},manage:function(){eXide.app.requireLogin(function(){e.reload("reload create upload properties open cut copy paste".split(" "),"manage");$("#open-dialog").dialog("option","title","DB Manager");$("#open-dialog").dialog("option","buttons",{Close:function(){$(this).dialog("close")}});$("#open-dialog").dialog("open")})},deploymentSettings:function(){var b=a.getActiveDocument().getPath(),d=/^(.*)\/[^\/]+$/.exec(b);
d&&eXide.app.requireLogin(function(){$.log("Editing deployment settings for collection: %s",d[1]);c.open(d[1])})},newDeployment:function(){eXide.app.requireLogin(function(){c.open()})},deploy:function(){eXide.app.requireLogin(function(){var b=a.getActiveDocument().getPath(),b=/^(.*)\/[^\/]+$/.exec(b);if(!b)return eXide.util.error("The file open in the editor does not belong to an application package!"),!1;$.log("Deploying application from collection: %s",b[1]);c.deploy(b[1])});return!1},synchronize:function(){eXide.app.requireLogin(function(){var b=
a.getActiveDocument().getPath();(b=/^(.*)\/[^\/]+$/.exec(b))?c.synchronize(b[1]):eXide.util.error("The file open in the editor does not belong to an application package!")})},downloadApp:function(){eXide.app.requireLogin(function(){var b=a.getActiveDocument().getPath(),b=/^(.*)\/[^\/]+$/.exec(b);$.log("downloading %s",b);b?c.download(b[1]):eXide.util.error("The file open in the editor does not belong to an application package!")})},openApp:function(){var b=a.getActiveDocument().getPath();(b=/^(.*)\/[^\/]+$/.exec(b))?
c.runApp(b[1]):eXide.util.error("The file open in the editor does not belong to an application package!")},restoreState:function(){if(!eXide.util.supportsHtml5Storage)return!1;b.read();var d={},e=localStorage["eXide.documents"];e||(e=0);for(var f=0;f<e;f++){var h={path:localStorage["eXide."+f+".path"],name:localStorage["eXide."+f+".name"],writable:"true"==localStorage["eXide."+f+".writable"],line:parseInt(localStorage["eXide."+f+".last-line"])};$.log("Restoring doc %s, going to line = %i",h.path,
h.line);var g=localStorage["eXide."+f+".data"];g?a.newDocumentWithText(g,localStorage["eXide."+f+".mime"],h):eXide.app.$doOpenDocument(h);d[h.path]=h}a.getActiveDocument()||eXide.app.newDocument("","xquery");c.restoreState();return d},saveState:function(){eXide.util.supportsHtml5Storage&&(localStorage.clear(),b.save(),a.saveState(),c.saveState())},getLogin:function(){$.ajax({url:"login",dataType:"json",success:function(a){eXide.app.login=a;$("#user").text("Logged in as "+eXide.app.login+". ")},error:function(){eXide.app.login=
null}})},$checkLogin:function(){if(eXide.app.login)return!0;eXide.util.error("Warning: you are not logged in.");return!1},requireLogin:function(a){eXide.app.login?a():($("#login-dialog").dialog("option","close",function(){eXide.app.login?a():eXide.util.error("Warning: you are not logged in!")}),$("#login-dialog").dialog("open"))},showPreferences:function(){b.show()},getPreference:function(a){return b.get(a)},initGUI:function(c){eXide.app.getLogin();var f=$("body").layout({enableCursorHotkey:!1,north__size:70,
north__resizable:!1,north__closable:!0,north__showOverflowOnHover:!0,south__minSize:200,south__initClosed:!0,west__size:200,west__initClosed:!1,west__contentSelector:".content",center__minSize:300,center__onresize:eXide.app.resize,center__contentSelector:".content"});$("#open-dialog").dialog({title:"Open file",modal:!1,autoOpen:!1,height:480,width:700,open:function(){e.init()},resize:function(){e.resize()}});$("#login-dialog").dialog({title:"Login",modal:!0,autoOpen:!1,buttons:{Login:function(){var b=
$('#login-form input[name="user"]').val(),c=$('#login-form input[name="password"]').val(),b={user:b,password:c};$('#login-form input[name="duration"]').is(":checked")&&(b.duration="P14D");$.ajax({url:"login",data:b,dataType:"json",success:function(){eXide.app.login=$('#login-form input[name="user"]').val();$.log("Logged in as %s",eXide.app.login);$("#login-dialog").dialog("close");$("#user").text("Logged in as "+eXide.app.login+". ");a.focus()},error:function(){$("#login-error").text("Login failed. Bad username or password.");
$("#login-dialog input:first").focus()}})},Cancel:function(){$(this).dialog("close");a.focus()}},open:function(){$(this).find("input").val("");$(this).find("input:first").focus();$("#login-error").empty();var a=$(this);a.find("input").keyup(function(b){13==b.keyCode&&a.parent().find(".ui-dialog-buttonpane button:first").trigger("click")})}});$("#keyboard-help").dialog({title:"Keyboard Shortcuts",modal:!1,autoOpen:!1,height:400,buttons:{Close:function(){$(this).dialog("close")}},open:function(){eXide.edit.commands.help($("#keyboard-help"),
a)}});$("#about-dialog").dialog({title:"About",modal:!1,autoOpen:!1,height:300,width:450,buttons:{Close:function(){$(this).dialog("close")}}});var h=$("#open").button({icons:{primary:"ui-icon-folder-open"}});h.click(eXide.app.openDocument);c.click("#menu-file-open",eXide.app.openDocument,"openDocument");h=$("#close").button({icons:{primary:"ui-icon-close"}});h.click(eXide.app.closeDocument);c.click("#menu-file-close",eXide.app.closeDocument,"closeDocument");h=$("#new").button({icons:{primary:"ui-icon-document"}});
h.click(function(){eXide.app.newDocument(null,"xquery")});c.click("#menu-file-new",eXide.app.newDocument,"newDocument");c.click("#menu-file-new-xquery",function(){eXide.app.newDocument(null,"xquery")},"newXQuery");h=$("#run").button({icons:{primary:"ui-icon-play"}});h.click(eXide.app.runQuery);h=$("#validate").button({icons:{primary:"ui-icon-check"}});h.click(eXide.app.checkQuery);h=$("#save").button({icons:{primary:"ui-icon-disk"}});h.click(eXide.app.saveDocument);c.click("#menu-file-save",eXide.app.saveDocument,
"saveDocument");c.click("#menu-file-save-as",eXide.app.saveDocumentAs);c.click("#menu-file-reload",eXide.app.reloadDocument);h=$("#download").button({icons:{primary:"ui-icon-transferthick-e-w"}});h.click(eXide.app.download);c.click("#menu-file-download",eXide.app.download);c.click("#menu-file-manager",eXide.app.manage,"dbManager");c.click("#menu-deploy-new",eXide.app.newDeployment);c.click("#menu-deploy-edit",eXide.app.deploymentSettings);c.click("#menu-deploy-deploy",eXide.app.deploy);c.click("#menu-deploy-sync",
eXide.app.synchronize,"synchronize");c.click("#menu-deploy-download",eXide.app.downloadApp);c.click("#menu-edit-undo",function(){a.editor.undo()},"undo");c.click("#menu-edit-redo",function(){a.editor.redo()},"redo");c.click("#menu-edit-find",function(){a.quicksearch.start()},"searchIncremental");c.click("#menu-edit-toggle-comment",function(){a.editor.toggleCommentLines()},"toggleComment");c.click("#menu-edit-preferences",function(){b.show()},"preferences");c.click("#menu-navigate-definition",function(){a.exec("gotoDefinition")},
"gotoDefinition");c.click("#menu-navigate-modules",function(){var b=a.getActiveDocument();eXide.find.Modules.select(b.syntax)},"findModule");c.click("#menu-navigate-info",function(){a.exec("showFunctionDoc")},"functionDoc");c.click("#menu-deploy-run",eXide.app.openApp,"openApp");c.click("#menu-help-keyboard",function(){$("#keyboard-help").dialog("open")});c.click("#menu-help-about",function(){$("#about-dialog").dialog("open")});c.click("#menu-help-hints",function(){eXide.util.Help.show()});$("#syntax").change(function(){a.setMode($(this).val())});
a.addEventListener("activate",null,function(a){$("#syntax").val(a.getSyntax());(a=d.getProjectFor(a.getBasePath()))?($("#toolbar-current-app").text(a.abbrev),$("#menu-deploy-active").text(a.abbrev)):($("#toolbar-current-app").text("unknown"),$("#menu-deploy-active").text("unknown"))});$("#user").click(function(a){a.preventDefault();eXide.app.login?($.get("login?logout=logout"),$("#user").text("Login"),eXide.app.login=null):$("#login-dialog").dialog("open")});$("#results-container .next").click(eXide.app.browseNext);
$("#results-container .previous").click(eXide.app.browsePrevious);f.toggle("south");f.toggle("south");$("#error-status").mouseover(function(){var a=this;$("#ext-status-bar").each(function(){this.innerHTML=a.innerHTML;$(this).css("display","block")})});$("#ext-status-bar").mouseout(function(){$(this).css("display","none")})}}}();eXide.namespace("eXide.edit.Projects");
eXide.edit.Projects=function(){Constr=function(){this.projects={}};Constr.prototype.getProject=function(a,c){var e=this;$.getJSON("modules/deployment.xql",{info:a},function(a){if(a){var b=e.projects[a.abbrev];b?eXide.util.oop.extend(b,a):(b=a,e.projects[a.abbrev]=b);"function"==typeof c&&c(b)}else eXide.util.error("Application not found: The document currently opened in the editor should belong to an application package.")})};Constr.prototype.getProjectFor=function(a){for(k in this.projects){var c=this.projects[k];
$.log("collection: %s -> root: %s",a.substring(0,c.root.length),c.root);if(a.substring(0,c.root.length)===c.root)return c}return null};Constr.prototype.saveState=function(){localStorage["eXide.projects"]=JSON.stringify(this.projects)};Constr.prototype.restoreState=function(){localStorage["eXide.projects"]&&(this.projects=JSON.parse(localStorage["eXide.projects"]),"object"!=typeof this.projects&&(this.projects={}))};return Constr}();eXide.namespace("eXide.edit.PackageEditor");
eXide.edit.PackageEditor=function(){Constr=function(a){var c=this;this.projects=a;this.currentProject=null;this.container=$("#dialog-deploy");this.container.dialog({title:"Deployment Editor",modal:!1,autoOpen:!1,width:520,height:600});this.syncDialog=$("#synchronize-dialog");this.syncDialog.dialog({title:"Synchronize to Directory",modal:!1,autoOpen:!1,width:500,height:400,buttons:{Apply:function(){var a=c.syncDialog.find('input[name="dir"]').val();a&&0<a.length&&(c.currentProject.dir=a);c.currentProject.autoSync=
c.syncDialog.find('input[name="auto"]').is(":checked");$(this).dialog("close")},Synchronize:function(){var a=c.syncDialog.find('input[name="dir"]').val();!a||0==a.length?$("#synchronize-report").text("No output directory specified!"):(c.currentProject.dir=a,a=c.syncDialog.find("form").serialize(),$("#synchronize-report").text("Synchronization in progress ..."),$("#synchronize-report").load("modules/synchronize.xql",a))},Close:function(){$(this).dialog("close")}}})};eXide.util.oop.inherit(Constr,eXide.events.Sender);
Constr.prototype.open=function(a){var c=this,e=null;a&&(e={collection:a});$.ajax({url:"modules/deployment.xql",type:"POST",data:e,success:function(d){c.container.html(d);c.container.form({done:function(){var b=c.container.find("form").serialize();$.ajax({url:"modules/deployment.xql",type:"POST",data:b,success:function(){c.container.dialog("close");c.$triggerEvent("change",a)},error:function(a){eXide.util.error(a.responseText)}})},cancel:function(){c.container.dialog("close")}});c.container.find(".author-repeat").repeat("#author-add-trigger",
{deleteTrigger:"#author-remove-trigger"});c.container.dialog("open")},error:function(a){eXide.util.error(a.responseText)}})};Constr.prototype.deploy=function(a){var c=this;eXide.util.Dialog.input("Deploy",'<p>Note: target has to be different from the source package or it will be overwritten!</p><p><label for="target">Target collection:</label><input id="deployment-target" type="text" name="target" value="'+a+'-test"size="30"/></p>',function(){var e=$("#deployment-target").val();""===e&&(e=a);$.ajax({url:"modules/deployment.xql",
type:"POST",dataType:"json",data:{collection:a,target:e,deploy:"true"},success:function(d){d=location.protocol+"//"+location.hostname+":"+location.port+"/exist/apps/"+d+"/";eXide.util.Dialog.message("Application Deployed",'<p>The application has been deployed. On a standard installation the following link should open it:</p><center><a href="'+d+'" target="_new">'+d+"</a></center>");c.$triggerEvent("change",a)},error:function(a){404==a.status?eXide.util.error("Deployment failed. The document currently opened in the editor should belong to an application package."):
eXide.util.Dialog.warning("Deployment Error","<p>An error has been reported by the database:</p><p>"+a.responseText+"</p>")}})})};Constr.prototype.download=function(a){window.location.href="modules/deployment.xql?download=true&collection="+encodeURIComponent(a)};Constr.prototype.synchronize=function(a){var c=this;c.projects.getProject(a,function(a){a.isAdmin?(c.currentProject=a,c.syncDialog.find(".project-name").text(a.abbrev),c.syncDialog.find('input[name="start"]').val(a.deployed),a.dir&&c.syncDialog.find('input[name="dir"]').val(a.dir),
c.syncDialog.find('input[name="collection"]').val(a.root),c.syncDialog.find('input[name="auto"]').attr("checked",a.autoSync),c.syncDialog.dialog("open")):eXide.util.error("You need to be logged in as an admin user with dba role to use this feature.")})};Constr.prototype.autoSync=function(a){(a=this.projects.getProjectFor(a))&&a.autoSync&&$.ajax({url:"modules/synchronize.xql",type:"GET",data:{collection:a.root,start:a.deployed,dir:a.dir},success:function(){eXide.util.message("Synchronized directory")}})};
Constr.prototype.runApp=function(a){this.projects.getProject(a,function(a){var e="/exist/apps/"+a.root.replace(/^\/db\//,"")+"/";eXide.util.Dialog.message("Run Application "+a.abbrev,'<p>Click on the following link to open your application:</p><center><a href="'+e+'" target="_new">'+e+"</a></center>")})};Constr.prototype.saveState=function(){this.projects.saveState()};Constr.prototype.restoreState=function(){this.projects.restoreState()};return Constr}();eXide.namespace("eXide.edit.Template");
eXide.edit.Template=function(){var a=/\n/;Constr=function(c,e,d,b){var f=d.split(a).length;this.code=d;this.editor=c.editor;this.range=e;this.type=b;this.startLine=e.start.row;this.endLine=this.startLine+f-1;$.log("startLine = %i, endLine = %i",this.startLine,this.endLine);this.currentLine=this.startLine;this.lineOffset=this.startColumn=e.start.column;this.regex=/\$[\w\-:_]+/g;0<this.startColumn&&(this.regex.lastIndex=this.startColumn)};Constr.prototype={insert:function(){this.editor.getSession().remove(this.range);this.editor.insert(this.code);
var a=this.editor.getSelection().getSelectionLead();"$"!=this.code.substring(0,1)&&0<a.column&&this.editor.navigateLeft();"variable"!=this.type&&this.nextParam();this.editor.focus()},nextParam:function(){var a=this.editor.getSession(),e=this.editor.getSelection(),d=e.getSelectionLead();$.log("lead.row = %i startLine = %i",d.row,this.startLine);if(d.row<this.startLine||d.row>this.endLine)return!1;for(var b=d=!1;this.currentLine<=this.endLine;){var f=a.getDisplayLine(this.currentLine);$.log("Checking line %s",
f);if(f=this.regex.exec(f)){$.log("Matched %s",f[0]);e.setSelectionAnchor(this.currentLine,f.index);e.selectTo(this.currentLine,f.index+f[0].length);this.lineOffset=f.index;b=!0;break}else this.lineOffset=0,this.currentLine++;this.currentLine>this.endLine&&!d&&($.log("loop %i",this.startColumn),this.currentLine=this.startLine,0<this.startColumn&&(this.lineOffset=this.startColumn,this.regex.lastIndex=this.lineOffset),d=!0)}return b}};return Constr}();eXide.namespace("eXide.util.Help");
eXide.util.Help=function(){var a=null,c=-1;$(document).ready(function(){$(document.body).append('<div id="eXide-dialog-help">\t<div class="help" id="eXide-dialog-help-body"></div></div>');helpDialog=$("#eXide-dialog-help");helpDialog.dialog({modal:!1,title:"Quick Start",autoOpen:!1,width:600,height:400,buttons:{OK:function(){$(this).dialog("close")},Next:function(){eXide.util.Help.next()},Previous:function(){eXide.util.Help.previous()}}});eXide.util.Help.showFirstTime()});return{show:function(){helpDialog.dialog("open");
a?eXide.util.Help.next():eXide.util.Help.load()},next:function(){c+1<a.length&&(c++,$("#eXide-dialog-help-body").html(a[c]))},previous:function(){0<c&&(c--,$("#eXide-dialog-help-body").html(a[c]))},showFirstTime:function(){if(eXide.util.supportsHtml5Storage){var a=localStorage.getItem("eXide.hints");(!a||1==a)&&eXide.util.Help.show()}},load:function(){$.ajax({url:"help.html",type:"GET",success:function(c){a=$("section",c);eXide.util.Help.show()},error:function(a){404==a.status?eXide.util.error("Failed to open help texts."):
eXide.util.Dialog.warning("Deployment Error","<p>An error has been reported by the database:</p><p>"+a.responseText+"</p>");helpDialog.dialog("close")}})}}}();eXide.namespace("eXide.util.Preferences");
eXide.util.Preferences=function(){var a={theme:"tomorrow",fontSize:"14px",showInvisibles:!1,showPrintMargin:!0,showHScroll:!1,softWrap:-1};Constr=function(c){this.editor=c;this.preferences=$.extend({},a);var e=this;$("#preferences-dialog").dialog({title:"Preferences",modal:!0,autoOpen:!1,height:400,width:600,buttons:{Cancel:function(){$(this).dialog("close");c.focus()},"Reset Defaults":function(){e.preferences=$.extend({},a);e.updateForm()},Save:function(){var a=$("form",this);e.preferences.theme=
$('select[name="theme"]',a).val();e.preferences.fontSize=$('select[name="font-size"]',a).val();e.preferences.showInvisibles=$('input[name="show-invisibles"]',a).is(":checked");e.preferences.showPrintMargin=$('input[name="print-margin"]',a).is(":checked");a=$('select[name="soft-wrap"]',a).val();"free"===a?a=-1:"off"===a&&(a=0);e.preferences.softWrap=parseInt(a);e.applyPreferences();$(this).dialog("close");c.focus()}}})};Constr.prototype.show=function(){this.updateForm();$("#preferences-dialog").dialog("open")};
Constr.prototype.updateForm=function(){$.log("Updating form");var a=$("#preferences-dialog form");$('select[name="theme"]',a).val(this.preferences.theme);$('select[name="font-size"]',a).val(this.preferences.fontSize);$('input[name="show-invisibles"]',a).attr("checked",this.preferences.showInvisibles);$('input[name="print-margin"]',a).attr("checked",this.preferences.showPrintMargin);var e=this.preferences.softWrap;0==e?e="off":-1===e&&(e="free");$('input[name="soft-wrap"]',a).val(e)};Constr.prototype.applyPreferences=
function(){$.log("Applying preferences: %o",this.preferences);var a=this;this.editor.setTheme(this.preferences.theme);this.editor.editor.setShowInvisibles(this.preferences.showInvisibles);this.editor.editor.renderer.setShowPrintMargin(this.preferences.showPrintMargin);this.editor.forEachDocument(function(e){0<a.preferences.softWrap?e.getSession().setWrapLimitRange(a.preferences.softWrap,a.preferences.softWrap):0>a.preferences.softWrap&&e.getSession().setWrapLimitRange(null,null);e.getSession().setUseWrapMode(0!=
a.preferences.softWrap)});$("#editor").css("font-size",this.preferences.fontSize);this.editor.resize()};Constr.prototype.get=function(a){return this.preferences[a]};Constr.prototype.read=function(){localStorage["eXide.preferences"]&&(this.preferences=JSON.parse(localStorage.getItem("eXide.preferences")));this.applyPreferences()};Constr.prototype.save=function(){localStorage.setItem("eXide.preferences",JSON.stringify(this.preferences));localStorage.setItem("eXide.hints",0)};return Constr}();eXide.namespace("eXide.browse.CollectionBrowser");
eXide.browse.CollectionBrowser=function(){Constr=function(a){var c=this;this.events={activate:[]};this.selected=null;var e=document.createElement("div");e.className="eXide-browse-collections eXide-browse-content";a.append(e);this.container=$(e);this.container.dynatree({persist:!1,rootVisible:!1,initAjax:{url:"modules/collections.xql"},clickFolderMode:1,autoFocus:!0,keyboard:!1,onActivate:function(a){var b=a.data.key;$.log("activate %s: is writable: %s",b,a.data.writable);c.selected=b;c.$triggerEvent("activate",
[b,a.data.writable])},onPostInit:function(a){$.log("Reloading: %s",a);c.select(c.selected)}})};eXide.util.oop.inherit(Constr,eXide.events.Sender);Constr.prototype.getSelection=function(){return this.selected};Constr.prototype.getSelected=function(){return{isCollection:!1,name:this.selected}};Constr.prototype.select=function(a){var c=this.container.dynatree("getTree"),e=null;a&&(e=c.getNodeByKey(a),null==e&&(a=a.substring(0,a.lastIndexOf("/")),$.log("Activating parent collection %s",a),e=c.getNodeByKey(a)));
null==e&&(a="/db",e=c.getNodeByKey(a));null!=e&&(this.selected=a);e.activate();e.expand(!0)};Constr.prototype.reload=function(){$.log("Reloading tree...");this.container.dynatree("getTree").reload()};Constr.prototype.createCollection=function(){var a=this;eXide.app.$checkLogin()&&eXide.util.Dialog.input("Create Collection",'<label for="collection">Name: </label><input type="text" name="collection" id="eXide-browse-collection-name"/>',function(){$.getJSON("modules/collections.xql",{create:$("#eXide-browse-collection-name").val(),
collection:a.selected},function(c){"fail"==c.status?eXide.util.Dialog.warning("Create Collection Error",c.message):a.reload()})})};Constr.prototype.deleteCollection=function(){var a=this;eXide.util.Dialog.input("Confirm Deletion","Are you sure you want to delete collection "+a.selected+"?",function(){$.getJSON("modules/collections.xql",{remove:a.selected},function(c){"fail"==c.status?eXide.util.Dialog.warning("Delete Collection Error",c.message):a.reload()})})};return Constr}();eXide.namespace("eXide.browse.ResourceBrowser");
eXide.browse.ResourceBrowser=function(){var a=[{id:"name",name:"Name",field:"name",width:120,formatter:function(a,b,c,e,j){return j.isCollection?'<span class="collection"><img src="resources/images/folder_add.png"/> '+c+"</span>":c},editor:Slick.Editors.Text},{id:"permissions",name:"Permissions",field:"permissions",width:80},{id:"owner",name:"Owner",field:"owner",width:70},{id:"group",name:"Group",field:"group",width:70},{id:"lastMod",name:"Last Modified",field:"last-modified",width:115}],c={editable:!1,
multiSelect:!1},e={editable:!0,autoEdit:!0,multiSelect:!0,enableCellNavigation:!0};Constr=function(c){var b=this;this.container=$(c);this.clipboard=[];this.clipboardMode="copy";this.events={activate:[],activateCollection:[],activateParent:[]};this.mode="save";this.inEditor=!1;this.collection=null;this.data=[];this.grid=new Slick.Grid(this.container,this.data,a,e);var f=new Slick.RowSelectionModel;this.grid.setSelectionModel(f);f.onSelectedRangesChanged.subscribe(function(){var a=f.getSelectedRows();
if(0!=b.data.length){for(var c=!0,d=0;d<a.length;d++)if(a[d]<b.data.length&&b.data[a[d]]&&!b.data[a[d]].writable){c=!1;break}b.$triggerEvent("activate",[1==a.length&&b.data[a[0]]&&!b.data[a[0]].isCollection?b.data[a[0]]:null,c])}});this.grid.onDblClick.subscribe(function(a){a=b.grid.getCellFromEvent(a);b.data[a.row].isCollection&&(a=".."==b.data[a.row].name?b.collection.replace(/\/[^\/]+$/,""):b.collection+"/"+b.data[a.row].name,b.$triggerEvent("activateCollection",[a]))});this.grid.onKeyDown.subscribe(function(a){if(!b.inEditor&&
!a.shiftKey&&!a.altKey&&!a.ctrlKey)if(13==a.which)a.stopPropagation(),a.preventDefault(),a=f.getSelectedRows(),1==a.length&&(b.data[a[0]].isCollection?(a=".."==b.data[a[0]].name?b.collection.replace(/\/[^\/]+$/,""):b.collection+"/"+b.data[a[0]].name,b.$triggerEvent("activateCollection",[a])):eXide.app.openSelectedDocument());else if(8==a.which){var c=b.collection.lastIndexOf("/");0<c&&(a.stopPropagation(),a.preventDefault(),"/db"!=b.collection&&(a=b.collection.substring(0,c),b.$triggerEvent("activateCollection",
[a])))}});this.grid.onBeforeEditCell.subscribe(function(a,c){b.inEditor=!0;b.oldValue=b.data[c.row].name});this.grid.onBeforeCellEditorDestroy.subscribe(function(){b.inEditor=!1});this.grid.onCellChange.subscribe(function(a,c){b.oldValue&&$.getJSON("modules/collections.xql",{target:b.data[c.row].name,rename:b.oldValue,root:b.collection},function(a){b.reload();b.data[c.row].isCollection&&b.$triggerEvent("activateCollection",[b.data[c.row].name]);"fail"==a.status&&eXide.util.Dialog.warning("Rename Error",
a.message)})});this.grid.onViewportChanged.subscribe(function(){var a=b.grid.getViewport();b.load(a.top,a.bottom)});$("#resource-properties-dialog").dialog({title:"Resource/collection properties",modal:!0,autoOpen:!1,height:320,width:460,buttons:{Cancel:function(){$(this).dialog("close")},Apply:function(){var a=this,c=b.grid.getSelectionModel().getSelectedRows();if(0!=c.length){for(var d=[],e=0;e<c.length;e++)d.push(b.collection+"/"+b.data[c[e]].name);c=$("form",a).serialize();c=c+"&"+$.param({"modify[]":d});
$.getJSON("modules/collections.xql",c,function(){$(a).dialog("close");b.reload()})}}}})};eXide.util.oop.inherit(Constr,eXide.events.Sender);Constr.prototype.setMode=function(a){this.mode=a;"manage"==a?this.grid.setOptions(e):this.grid.setOptions(c)};Constr.prototype.resize=function(){this.grid.resizeCanvas();this.grid.focus()};Constr.prototype.update=function(a,b){if(b||a!==this.collection)$.log("Opening resources for %s",a),this.collection=a,this.grid.invalidate(),this.data.length=0,this.grid.setActiveCell(0,
1),this.grid.setSelectedRows([]),this.grid.onViewportChanged.notify(),this.grid.focus()};Constr.prototype.load=function(a,b){var c=this;$.getJSON("modules/collections.xql",{root:this.collection,view:"r",start:a,end:b},function(e){for(var j=a;j<=b;j++)c.grid.invalidateRow(j);if(e&&e.items){c.data.length=e.total;for(j=0;j<e.items.length;j++)c.data[a+j]=e.items[j]}else c.data.length=0;c.grid.updateRowCount();c.grid.render();0==a&&(c.grid.setActiveCell(0,1),c.grid.focus())})};Constr.prototype.hasSelection=
function(){var a=this.grid.getSelectionModel().getSelectedRows();return a&&0<a.length};Constr.prototype.getSelected=function(){var a=this.grid.getSelectionModel().getSelectedRows();if(0==a.length)return null;for(var b=[],c=0;c<a.length;c++)b.push(this.collection+"/"+this.data[a[c]].name);return b};Constr.prototype.deleteResource=function(){var a=this.grid.getSelectionModel().getSelectedRows();if(0!=a.length){for(var b=[],c=0;c<a.length;c++)b.push(this.data[a[c]].name);var e=this;eXide.util.Dialog.input("Confirm Deletion",
"Are you sure you want to delete the selected resources?",function(){$.log("Deleting resources %o",b);$.getJSON("modules/collections.xql",{remove:b,root:e.collection},function(a){e.reload();"fail"==a.status&&eXide.util.Dialog.warning("Delete Resource Error",a.message)})})}};Constr.prototype.properties=function(){var a=this.grid.getSelectionModel().getSelectedRows();if(0!=a.length){for(var b=[],c=0;c<a.length;c++)b.push(this.collection+"/"+this.data[a[c]].name);$("#resource-properties-content").load("modules/collections.xql",
{properties:b});$("#resource-properties-dialog").dialog("open")}};Constr.prototype.cut=function(){this.clipboardMode="move";this.copy()};Constr.prototype.copy=function(){var a=this.grid.getSelectionModel().getSelectedRows();this.clipboard=[];for(var b=0;b<a.length;b++){var c=this.data[a[b]].name;"/"!=c.substr(0,1)&&(c=this.collection+"/"+c);this.clipboard.push(c)}$.log("Clipboard: %o",this.clipboard)};Constr.prototype.paste=function(){var a=this;$.log("Copying resources %o to %s",this.clipboard,this.collection);
var b={root:this.collection};b[this.clipboardMode]=this.clipboard;$.getJSON("modules/collections.xql",b,function(b){$.log(b.status);"fail"==b.status?eXide.util.Dialog.warning("Delete Resource Error",b.message):a.reload()})};Constr.prototype.focus=function(){this.container.find(".grid-canvas").focus()};Constr.prototype.reload=function(){this.update(this.collection,!0)};return Constr}();eXide.namespace("eXide.browse.Upload");
eXide.browse.Upload=function(){Constr=function(a){this.container=a;this.events={done:[]};$("#file_upload").fileUploadUI({sequentialUploads:!0,uploadTable:$("#files"),buildUploadRow:function(a,c){return $("<tr><td>"+a[c].name+'</td><td class="file_upload_progress"><div></div></td><td class="file_upload_cancel"><button class="ui-state-default ui-corner-all" title="Cancel"><span class="ui-icon ui-icon-cancel">Cancel</span></button></td></tr>')},buildDownloadRow:function(a){return a.error?$("<tr><td>"+
a.name+"</td><td>"+a.error+"</td></tr>"):null}});var c=this;$("#eXide-browse-upload-done").button().click(function(){$("#files").empty();c.$triggerEvent("done",[])})};eXide.util.oop.inherit(Constr,eXide.events.Sender);Constr.prototype.update=function(a){$('input[name="collection"]',this.container).val(a)};return Constr}();eXide.namespace("eXide.browse.Browser");
eXide.browse.Browser=function(){function a(a,e,d,b,f){var h=document.createElement("button");h.title=e;h.id="eXide-browse-toolbar-"+d;h.tabindex=b;e=document.createElement("img");e.src="resources/images/"+f;h.appendChild(e);a.append(h);return h}Constr=function(c){var e=this;this.mode="open";var d=$(".eXide-browse-toolbar",c),b=a(d,"Reload","reload",1,"arrow_refresh.png");$(b).click(function(){e.resources.reload(!0);e.collections.reload()});this.btnCreateCollection=a(d,"Create Collection","create",
3,"folder_add.png");$(this.btnCreateCollection).click(function(a){a.preventDefault();e.collections.createCollection()});this.btnUpload=a(d,"Upload Files","upload",4,"database_add.png");$(this.btnUpload).click(function(a){a.preventDefault();$(".eXide-browse-resources",c).hide();$(".eXide-browse-upload",c).show()});this.btnDeleteResource=a(d,"Delete","delete-resource",5,"bin.png");$(this.btnDeleteResource).click(function(a){a.preventDefault();e.deleteSelected()});this.btnProperties=a(d,"Properties",
"properties",10,"application_form_edit.png");$(this.btnProperties).click(function(a){a.preventDefault();e.resources.properties()});b=a(d,"Open Selected","open",6,"page_edit.png");$(b).click(function(a){a.preventDefault();eXide.app.openSelectedDocument(!1)});this.btnCopy=a(d,"Copy","copy",7,"page_copy.png");this.btnCut=a(d,"Cut","cut",8,"cut.png");this.btnPaste=a(d,"Paste","paste",9,"page_paste.png");this.selection=$(".eXide-browse-form input",c);this.container=c;this.resources=new eXide.browse.ResourceBrowser($(".eXide-browse-resources",
c));this.collections=new eXide.browse.CollectionBrowser($(".eXide-browse-collections",c));this.upload=new eXide.browse.Upload($(".eXide-browse-upload",c).hide());this.layout=null;this.collections.addEventListener("activate",this,this.onActivateCollection);this.collections.addEventListener("activate",this.resources,this.resources.update);this.collections.addEventListener("activate",this.upload,this.upload.update);this.resources.addEventListener("activate",this,this.onActivateResource);this.resources.addEventListener("activateCollection",
this,this.onChangeCollection);this.upload.addEventListener("done",this,function(){$(".eXide-browse-resources",c).show();$(".eXide-browse-upload",c).hide();this.reload()});$(this.btnCopy).click(function(a){a.preventDefault();e.resources.copy()});$(this.btnCut).click(function(a){a.preventDefault();e.resources.cut()});$(this.btnPaste).click(function(a){a.preventDefault();e.resources.paste()})};Constr.prototype={init:function(){var a=$(this.container).innerHeight()-$(".eXide-browse-form",this.container).height()-
25;$(".eXide-browse-panel",this.container).height(a);null==this.layout&&(this.layout=$(".eXide-browse-panel",this.container).layout({enableCursorHotkey:!1,north__resizable:!1,north__closable:!1,north__spacing_open:0,south__resizable:!1,west__size:200,west__initClosed:!1,west__contentSelector:".eXide-browse-content",center__minSize:300,center__contentSelector:".eXide-browse-content",onresize:function(){this.resources.resize()}}),this.resources.resize())},reload:function(a,e){if(a){$(".eXide-browse-toolbar button",
this.container).hide();for(var d=0;d<a.length;d++)$("#eXide-browse-toolbar-"+a[d]).show()}e&&(this.mode=e);this.resources.setMode(e);"save"===this.mode?$(".eXide-browse-form",this.container).show().focus():$(".eXide-browse-form",this.container).hide();null!=this.layout&&(this.resize(),this.collections.reload(),this.resources.update(this.collections.getSelection(),!0),$(this.selection).val(""))},resize:function(){var a=$(this.container).innerHeight()-$(".eXide-browse-form",this.container).height()-
25;$(".eXide-browse-panel",this.container).height(a);this.layout.resizeAll()},deleteSelected:function(){var a=this.resources.getSelected();if(null==a){var a=this.collections.getSelected(),e=this;eXide.util.Dialog.input("Confirm Deletion","Are you sure you want to delete the selected collections?",function(){$.log("Deleting collection %o",a);$.getJSON("modules/collections.xql",{remove:[a.name]},function(a){e.reload();"fail"==a.status&&eXide.util.Dialog.warning("Delete Collection Error",a.message)})})}else this.resources.deleteResource()},
getSelection:function(){var a=$(this.selection).val();return null==a||""==a?null:{name:a,path:this.collections.getSelection()+"/"+a,writable:!0}},onActivateResource:function(a,e){a?$(this.selection).val(a.name):$(this.selection).val("");"open"!=this.mode&&e?($(this.btnDeleteResource).css("display",""),$(this.btnProperties).css("display","")):($(this.btnDeleteResource).css("display","none"),$(this.btnProperties).css("display","none"))},onActivateCollection:function(a,e){"open"!=this.mode&&e?($(this.btnCreateCollection).css("display",
""),$(this.btnUpload).css("display",""),$(this.btnDeleteResource).css("display",""),$(this.btnCut).css("display",""),$(this.btnPaste).css("display",""),$(this.btnProperties).css("display","")):($(this.btnCreateCollection).css("display","none"),$(this.btnUpload).css("display","none"),$(this.btnDeleteResource).css("display","none"),$(this.btnCut).css("display","none"),$(this.btnPaste).css("display","none"),$(this.btnProperties).css("display","none"));this.resources.update(a,e);this.upload.update(a,
e)},onChangeCollection:function(a){this.collections.select(a);this.collections.reload();this.resources.update(this.collections.getSelection())},onChange:function(){$.log("Reloading db manager views");this.collections.reload()}};return Constr}();eXide.namespace("eXide.find.IncrementalSearch");
eXide.find.IncrementalSearch=function(){var a={backwards:!1,wrap:!0,caseSensitive:!1,wholeWord:!1,regExp:!1};Constr=function(a,e){var d=this;d.input=$(a);d.input.hide();d.input.keydown(function(a){switch(a.which){case 27:case 13:a.preventDefault();d.input.hide();d.editor.focus();break;case 40:a.preventDefault();d.editor.findNext();break;case 38:a.preventDefault();d.editor.findPrevious();break;default:d.onChange()}});d.editor=e};Constr.prototype.start=function(){this.currentLine=this.editor.getSession().getSelection().getSelectionLead().row;
this.input.val("");this.input.show().focus()};Constr.prototype.onChange=function(){this.editor.gotoLine(this.currentLine);var c=this.input.val();this.editor.find(c,a,!0)};return Constr}();eXide.namespace("eXide.find.Modules");
eXide.find.Modules=function(){var a={open:[],"import":[]},c=[{id:"prefix",name:"Prefix",field:"prefix",sortable:!0,resizable:!0,maxWidth:100,minWidth:60},{id:"uri",name:"URI",field:"uri",sortable:!0,resizable:!0,minWidth:100},{id:"at",name:"Location",field:"at",sortable:!0,resizable:!0}],e={editable:!1,multiSelect:!1,forceFitColumns:!0},d=[],b;$(document).ready(function(){$.log("Initializing import module dialog");$("#select-module-dialog").dialog({modal:!1,autoOpen:!1,height:400,width:600,open:eXide.find.Modules.$init});
b=new Slick.Grid("#module-list",d,c,e);var a=new Slick.RowSelectionModel({selectActiveRow:!0});b.setSelectionModel(a);b.onDblClick.subscribe(function(a){a=b.getCellFromEvent(a);eXide.find.Modules.$triggerEvent("open",[d[a.row]])});b.onSort.subscribe(function(a,c){$.log("sorting on field: %s",c.sortCol.field);d.sort(function(a,b){var d=c.sortCol.field,e=a[d],d=b[d],e=(e==d?0:e>d?1:-1)*(c.sortAsc?1:-1);return 0!=e?e:0});b.invalidate();b.render()})});return{select:function(a){var b={Open:function(){eXide.find.Modules.trigger("open");
$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}};"xquery"==a&&(b.Import=function(){eXide.find.Modules.trigger("import");$(this).dialog("close")});$("#select-module-dialog").dialog("option","buttons",b);$("#select-module-dialog").dialog("open")},trigger:function(a){var c=b.getSelectionModel().getSelectedRows();1==c.length&&eXide.find.Modules.$triggerEvent(a,[d[c[0]]])},$init:function(){b.resizeCanvas();b.invalidate();d.length=0;$.getJSON("modules/find.xql",function(a){d.length=
a.length;for(var c=0;c<a.length;c++)d[c]=a[c];b.updateRowCount();b.render();b.setActiveCell(0,0);b.setSelectedRows([0]);$("#module-list").find(".grid-canvas").focus()})},addEventListener:function(b,c,d){(b=a[b])&&b.push({obj:c,callback:d})},$triggerEvent:function(b,c){var d=a[b];if(d)for(var e=0;e<d.length;e++)d[e].callback.apply(d[e].obj,c)}}}();eXide.namespace("eXide.util.Menubar");
eXide.util.Menubar=function(){Constr=function(a){var c=this;this.container=a;var e=!1;$("ul li",this.container).click(function(a){a.stopPropagation();$("ul",this).css({display:"block"});e=!0});$("body").click(function(){e&&$("ul li ul",c.container).css({display:"none"})})};Constr.prototype.click=function(a,c,e){var d=this;if(e){var b=eXide.edit.commands.getShortcut(e);b&&(b=b.replace(/Command/g,String.fromCharCode(8984)),b=b.replace(/Shift/g,String.fromCharCode(8679)),b=b.replace(/Option/g,String.fromCharCode(8997)),
b=b.replace(/Control/g,"^"),$(a).each(function(){var a=document.createElement("span");a.className="shortcut";a.appendChild(document.createTextNode(b));this.appendChild(a)}))}$(a).click(function(a){a.preventDefault();$("ul li ul",d.container).css({display:"none"});c()})};Constr.prototype.add=function(a,c,e,d){var b=this,a=$(this.container).find('ul li[title="'+a+'"]'),a=a.find("ul");a.append($('<li><a href="#" title="'+e+'">'+c+"</a></li>"));a.find("li:last-child a").click(function(a){a.preventDefault();
d();$("ul li ul",b.container).css({display:"none"})})};Constr.prototype.remove=function(a,c){$.log("Removing menu entry %s",c);a=$(this.container).find('ul li[title="'+a+'"]');a.find('ul li a[title = "'+c+'"]').remove()};return Constr}();